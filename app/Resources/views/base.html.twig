<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>{% block title %}Welcome!{% endblock %}</title>
        <script src="javascript/jquery-2.1.4.min.js" type="text/javascript"></script>
        <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <style type="text/css">
            body {
                background-color: #f5f5f5;
            }
            #main-container {
                background-color: #fff;
                border: 1px solid #4f86f7;
                border-radius: 3px;
                margin-top: 30px;
            }
            #menu {
                background-color: #6699cc;
                border-bottom: 1px solid #4f86f7;
                margin-bottom: 9px;
                margin-left: -15px;
                margin-right: -15px;
            }
            #menu li {
                background-color: #fefefe;
                margin: 0;
            }
            #menu li:hover {
                background-color: #f5f5f5;
            }
            #menu li:not(:first-child) {
                border-left: 1px dashed #6699cc;
            }
            #menu li.active a {
                background-color: #9aceeb;
            }
            #menu li.active:hover a {
                background-color: #a6e7ff;
            }
            #menu li a {
                border-radius: 0;
                color: #6699cc;
            }
            #menu li:hover a {
                color: #4f86f7;
            }
            #foot {
                font-size: 10px;
            }
            #version-tag {
                font-size: 8px;
            }
            #graphs-list .list-group-item.active {
                background-color: #8ba8b7;
                border-color: #8ba8b7;
            }
        </style>
        {% block stylesheets %}{% endblock %}
        <link rel="icon" type="image/x-icon" href="{{ asset('favicon.ico') }}" />
        <script type="text/javascript">
            function refreshList()
            {
                $.ajax({
                    url: '/refresh-list',
                    method: 'post',
                    dataType: 'json',
                    success: function (data) {
                        if (data.success == 1) {
                            $('#graphs-list :not(:first-child)').remove();
                            if (data.savedGraphs.length == 0) {
                                $('#add-new').remove();
                                $('#graphs-list').append('<div class="panel-body text-center"><p>There is no saved graphs</p><p><button id="add-new" type="button" class="btn btn-default" aria-label="Add New">Add New <span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button></p></div>');
                            } else {
                                if ($('#add-new').length == 0) {
                                    $('.panel-heading').append('<button id="add-new" type="button" class="btn btn-default btn-sm" aria-label="Add New"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>');
                                }

                                var html = '<div class="list-group">';
                                for (var graph in data.savedGraphs) {
                                    html += '<a class="list-group-item">' + data.savedGraphs[graph].name + '</a>';
                                }
                                html += '</div>';

                                $('#graphs-list').append(html);
                            }
                        }
                    }
                });
            }

            $(document).ready(function () {
                $(document).on('click', '#add-new', function () {
                    if ($('#popup-container').length == 0) {
                        $.ajax({
                            url: '/create-new',
                            method: 'post',
                            success: function (data) {
                                if ($('#popup-container').length == 0) {
                                    $('body').append(data);
                                }
                            }
                        });
                    }
                    return false;
                });

                $(document).on('dblclick', '#graphs-list .list-group-item:not(.active)', function () {
                    $('#graphs-list .list-group-item.active').removeClass('active');
                    $(this).addClass('active');

                    $('#choose-graph').css('display', 'none');
                    $('#graph-designer').css('display', 'block');
                })
                .on('dblclick', '#graphs-list .list-group-item.active', function () {
                    $(this).removeClass('active');

                    $('#choose-graph').css('display', 'block');
                    $('#graph-designer').css('display', 'none');
                });
            });
        </script>
    </head>
    <body>
        <div class="container-fluid">
            <div class="row">
                <div id="main-container" class="col-md-8 col-md-push-2">
                    <div class="container-fluid">
                        <div class="row">
                            <ul id="menu" class="nav nav-pills">
                                <li class="active">
                                    <a href="/">Home</a>
                                </li>
                            </ul>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <div id="graphs-list" class="panel panel-default">
                                    <div class="panel-heading">
                                        Saved Graphs
                                        {% if savedGraphs %}
                                            <button id="add-new" type="button" class="btn btn-default btn-sm" aria-label="Add New">
                                                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                            </button>
                                        {% endif %}
                                    </div>
                                    {% if savedGraphs %}
                                        <div class="list-group">
                                            {% for graph in savedGraphs %}
                                                <a class="list-group-item">
                                                    {{ graph.name }}
                                                </a>
                                            {% endfor%}
                                        </div>
                                    {% else %}
                                        <div class="panel-body text-center">
                                            <p>There is no saved graphs</p>
                                            <p>
                                                <button id="add-new" type="button" class="btn btn-default" aria-label="Add New">
                                                    Add New <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                                </button>
                                            </p>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-9">
                                {% block body %}{% endblock %}
                            </div>
                        </div>
                        <div class="row">
                            <div id="foot" class="col-md-12 text-center">
                                <strong>GraphDesigner</strong>
                                <span id="version-tag">v0.0.1</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% block javascripts %}{% endblock %}
    </body>
</html>
